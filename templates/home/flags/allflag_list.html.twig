{% extends 'base.html.twig' %}
{% block body %}
<div class="row">
    <div class="col-md-12">
        <table class="table table-bordered table-hover">
		    <thead class="topbotbackground">
			    <tr>
				    <th style="width: 1%"></th>
					<th style="width: 1%"></th>
					<th style="width: 58%">
					    Sujets
					</th>
					<th style="width: 10%">
						Dern. page
					</th>
					<th style="width: 10%">
						Auteur du sujet
					</th>
					<th style="width: 10%">
						Nombre de réponses
					</th>
					<th style="width: 10%">
						Dernier message
					</th>
				</tr>
			</thead>
            <tbody>
        {% for category in categories %}
                {% set newMessages = false %}
			    <tr class="topbotbackground">
				    <td colspan="7" class="text-center"><a href="{{ path('topics_list', { 'slug': category.slug }) }}">{{ category.titre }}</a></td>
				</tr>
                {% for flag in flags|filter((flag) => flag.flagCategoryId == category.id)  %}
                    {% if flag.flagPostId != flag.lastPostId %}
                    {% set newMessages = true %}
                    {% set topicPage = (flag.postCount / pagination.limit)|round(0, 'ceil') %}
                		<tr>
						    <td class="align-middle">
						        <img src="/build/images/icones/newmsg.gif">
							</td>
							<td class="align-middle">
								{% if flag.color == 'green' %}
									<a href="{{ path('post', { 'id': flag.flagPostId }) }}"><i class="fas fa-bookmark greenmark"></i></a>
								{% else %}
									<a href="{{ path('post', { 'id': flag.flagPostId }) }}"><i class="fas fa-bookmark bluemark"></i></a>
								{% endif %}
							</td>
							<td class="align-middle">
								<a href="{{ path('posts_list', { 'slug': flag.catSlug, 'topic_slug': flag.topicSlug }) }}">{{ flag.topicTitre }}</a>
							</td>
							<td class="align-middle">
                            	{% if topicPage > 1 %}
								    <a href="{{ path('posts_list', { 'slug': flag.catSlug, 'topic_slug': flag.topicSlug, 'page': topicPage }) }}">{{ topicPage }}</a>
								{% endif %}
							</td>
							<td class="align-middle">
								{{ flag.topicUser }}
							</td>
							<td class="align-middle">
								{{ flag.postCount - 1 }}
							</td>
							<td style="font-size: 12px" class="text-center">
								{{ flag.lastPostCreated|date("\\L\\e d/m/Y à H\\Hi")}} &nbsp
								par {{ flag.lastPostUserPseudo }}
							</td>
						</tr>
                    {% endif %}
                {% endfor %}
                {% if newMessages == false %}
                    <tr>
				        <td colspan="7" class="text-center">Pas de nouveaux messages</td>
				    </tr>
                {% endif %}
        {% endfor %}
        	</tbody>
        </table>
    </div>
</div>
{% endblock %}